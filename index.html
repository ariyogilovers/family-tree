<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Keluarga Sihite - Family Tree</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Rajdhani:wght@300;500;700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <!-- Supabase CDN -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>

<body>
    <!-- Space Background -->
    <div class="space-background">
        <div class="stars-small"></div>
        <div class="stars-medium"></div>
        <div class="stars-large"></div>
        <div class="planet-1"></div>
        <div class="nebula-1"></div>
        <!-- Shooting Star lines -->
        <span class="shooting-star"></span>
        <span class="shooting-star"></span>
        <span class="shooting-star"></span>
    </div>

    <div class="container">
        <h1 class="title" id="pageTitle">KELUARGA SIHITE</h1>

        <!-- Auth Buttons -->
        <div class="auth-controls">
            <!-- Music Control -->
            <button id="musicBtn" class="btn-auth btn-music" title="Play/Pause Music">ðŸŽµ</button>
            <audio id="spaceAudio" loop>
                <source src="assets/space_music.mp3" type="audio/mpeg">
            </audio>

            <span id="userEmail" class="user-email" style="display: none;"></span>
            <button id="loginBtn" class="btn-auth">Login Admin</button>
            <button id="logoutBtn" class="btn-auth" style="display: none;">Logout</button>
        </div>

        <div id="liveClock" class="live-clock"></div>
        <button id="addMemberBtn" class="btn-add" style="display: none;">+ Tambah Anggota</button>

        <!-- Zoom Controls -->
        <div class="zoom-controls">
            <button id="zoomOut" class="zoom-btn" title="Perkecil">âˆ’</button>
            <span id="zoomLevel" class="zoom-level">100%</span>
            <button id="zoomIn" class="zoom-btn" title="Perbesar">+</button>
            <button id="zoomReset" class="zoom-btn zoom-reset" title="Reset">âŸ²</button>
        </div>

        <div id="familyTree" class="tree">
            <!-- Tree will be rendered by JavaScript -->
        </div>
    </div>

    <!-- Detail Modal -->
    <div id="infoModal" class="modal">
        <div class="modal-content">
            <span class="close" data-modal="infoModal">&times;</span>
            <div class="modal-avatar">
                <img id="modalPhoto" src="" alt="Foto Profile">
            </div>
            <h2 id="modalName">Name</h2>
            <div class="modal-body">
                <p><strong>TTL:</strong> <span id="modalTTL"></span></p>
                <p><strong>Alamat:</strong> <span id="modalAddress"></span></p>
                <p><strong>No HP:</strong> <span id="modalHP"></span></p>
                <p><strong>No KTP:</strong> <span id="modalKTP"></span></p>
            </div>
            <div class="modal-actions">
                <button id="editFromDetail" class="btn-edit">Edit</button>
                <button id="deleteFromDetail" class="btn-delete">Hapus</button>
            </div>
        </div>
    </div>

    <!-- Form Modal -->
    <div id="formModal" class="modal">
        <div class="modal-content form-modal">
            <span class="close" data-modal="formModal">&times;</span>
            <h2 id="formTitle">Tambah Anggota Baru</h2>
            <form id="memberForm">
                <input type="hidden" id="memberId">
                <div class="form-group">
                    <label for="inputName">Nama</label>
                    <input type="text" id="inputName" required>
                </div>
                <div class="form-group">
                    <label for="inputRole">Peran/Jabatan</label>
                    <input type="text" id="inputRole" placeholder="e.g. Founder, Architect">
                </div>
                <div class="form-group">
                    <label for="inputMarga">Marga</label>
                    <input type="text" id="inputMarga" placeholder="Contoh: Sihite, Lumbangaol">
                </div>
                <div class="form-group">
                    <label for="inputTTL">Tempat, Tanggal Lahir</label>
                    <input type="text" id="inputTTL" placeholder="Jakarta, 01-01-1990">
                </div>
                <div class="form-group">
                    <label for="inputAddress">Alamat</label>
                    <input type="text" id="inputAddress">
                </div>
                <div class="form-group">
                    <label for="inputHP">No HP</label>
                    <input type="text" id="inputHP">
                </div>
                <div class="form-group">
                    <label for="inputKTP">No KTP</label>
                    <input type="text" id="inputKTP">
                </div>
                <div class="form-group">
                    <label for="inputPhoto">URL Foto</label>
                    <input type="text" id="inputPhoto" placeholder="https://...">
                </div>
                <div class="form-group">
                    <label for="inputParent">Orang Tua</label>
                    <select id="inputParent">
                        <option value="">-- Tidak Ada (Root) --</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="inputSpouse">Pasangan</label>
                    <select id="inputSpouse">
                        <option value="">-- Tidak Ada --</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="inputBirthOrder">Urutan Anak (1 = pertama, 2 = kedua, dst)</label>
                    <input type="number" id="inputBirthOrder" value="1" min="1" placeholder="1">
                </div>
                <div class="form-group">
                    <label for="inputGeneration">Generasi</label>
                    <input type="number" id="inputGeneration" value="1" min="1">
                </div>
                <div class="form-group checkbox-group">
                    <label class="checkbox-label">
                        <input type="checkbox" id="inputDeceased" onchange="toggleDeathYear()">
                        <span class="checkmark"></span>
                        Sudah Meninggal
                    </label>
                </div>
                <div class="form-group" id="deathYearGroup" style="display: none;">
                    <label for="inputDeathYear">Tahun Meninggal</label>
                    <input type="number" id="inputDeathYear" placeholder="contoh: 2020" min="1900" max="2100">
                </div>
                <div class="form-actions">
                    <button type="submit" class="btn-save">Simpan</button>
                    <button type="button" class="btn-cancel" data-modal="formModal">Batal</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div id="deleteModal" class="modal">
        <div class="modal-content delete-modal">
            <h2>Konfirmasi Hapus</h2>
            <p>Apakah Anda yakin ingin menghapus <strong id="deleteName"></strong>?</p>
            <div class="form-actions">
                <button id="confirmDelete" class="btn-delete">Ya, Hapus</button>
                <button class="btn-cancel" data-modal="deleteModal">Batal</button>
            </div>
        </div>
    </div>

    <!-- Image Popup Modal -->
    <div id="imageModal" class="modal image-modal-overlay">
        <span class="close-image" id="closeImageModal">&times;</span>
        <img class="modal-content-image" id="fullImage">
    </div>

    <!-- Login Modal -->
    <div id="loginModal" class="modal">
        <div class="modal-content form-modal" style="max-width: 400px;">
            <span class="close" data-modal="loginModal">&times;</span>
            <h2>Login Admin</h2>
            <form id="loginForm">
                <div class="form-group">
                    <label for="email">Email</label>
                    <input type="email" id="email" required>
                </div>
                <div class="form-group">
                    <label for="password">Password</label>
                    <input type="password" id="password" required>
                </div>
                <div class="form-actions">
                    <button type="submit" class="btn-save">Login</button>
                </div>
                <!-- Dev Note: User must sign up manually via Supabase Console or I should provide a temp signup button -->
                <p style="margin-top:15px; font-size: 0.8rem; color: #888; text-align: center;">
                    Belum punya akun? <a href="#" id="devSignup" style="color: var(--neon-cyan);">Daftar disini</a> (Dev
                    Mode)
                </p>
            </form>
        </div>
    </div>

    <script src="script.js"></script>
</body>

</html>